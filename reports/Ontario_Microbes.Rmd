---
title: "Report on Lake Ontario Microbes"
author: "Christine Yang"
date: "2026-02-18"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages

First, we need to ensure we have access to the functions that we need for our analysis.

```{r load-packages}
library(tidyverse)
```

# Goal Of This Report

Here, I create an analysis of environmental and microbial data from Lake Ontario. The goal is to determine how environmental variables like temperature affect the abundance of different Phyla of bacteria.

# Read In The Data

We need two files: 1) The Taxon File (Cleaned Up); 2) The Sample Data

## 1) Taxonomy Data

```{r load-data-taxon}
# Load The Taxon Abundance Data
taxon_dirty_df <-
  read_csv("data/taxon_abundance.csv", skip = 2) %>%
  select(-...10) %>%
  rename(sequencer = ...9)

# Look At Top Of Data-frame
head(taxon_dirty_df, 6)
# View(taxon_dirty_df)

# Clean Up Data By Removing Columns
taxon_clean_df <-
  taxon_dirty_df %>%
  select(sample_id:Cyanobacteria)

# How Many Columns? Intuition Check!
ncol(taxon_clean_df)
ncol(taxon_dirty_df)
```

Let's Load Second Data-set!

## 2) Enviromental Data

```{r load-data-samples}
sample_data_df <-
  read_csv("data/sample_data.csv")

# Quick Look
head(sample_data_df)
```

# Reshaping The Data

Create long-formatted data from wide-formatted data.

```{r reshape-data}
taxon_long_df <-
  taxon_clean_df %>%
    pivot_longer(cols = Proteobacteria:Cyanobacteria,
               names_to = "Phylum", values_to = "Abundance")

# Intuition Check
nrow(taxon_long_df)
nrow(taxon_clean_df)
```

## Plot Taxon Data

```{r plot-taxa}
taxon_long_df %>%
  ggplot(aes(x = sample_id, y = Abundance, fill = Phylum)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90)) 
```

# Joining The Data

 We will combine taxonomy and environmental data together into one data-frame.

```{r join-data}
# Let's Check sample_id
sample_data_df$sample_id
taxon_clean_df$sample_id

# Check Length
length(sample_data$sample_id)
length(taxon_clean_df$sample_id)

# Fix The Sample Names
taxon_clean_goodSep_df <-
  taxon_clean_df %>%
    # Rename sample_id Names For Merging 
    mutate(sample_id = str_replace(sample_id, pattern = "Sep", replacement = "September"))

# Sample Names Are Different!
sample_and_taxon_df <-
  inner_join(sample_data_df, taxon_clean_goodSep_df, by = "sample_id")

#Intuition Check
dim(sample_and_taxon_df)

# Write The File
write_csv(sample_and_taxon_df, file = "data/sample_and_taxon.csv")
```

#Plot Chloroflexi

```{r plot-chloroflexi}
ggplot(sample_and_taxon_df, 
       aes (x = depth, y = Chloroflexi)) +
  geom_point() +
  labs(x = "Depth (meters)", y = "Chloroflexi (Relative Abundance)",
       title = "Strong Association of Depth and Chloroflexi Abundance") +
  geom_smooth(method = "lm", formula = y ~ poly(x, 2))
```

